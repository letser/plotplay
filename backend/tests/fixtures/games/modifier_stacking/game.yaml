meta:
  id: "modifier_stacking"
  title: "Modifier Stacking Fixture"
  version: "0.0.1"
  authors: ["Test Suite"]

start:
  location: "lounge"
  node: "hub"
  day: 1
  time: "08:00"

time:
  slots_enabled: true
  slots: ["morning", "afternoon", "night"]
  slot_windows:
    morning: { start: "06:00", end: "11:59" }
    afternoon: { start: "12:00", end: "17:59" }
    night: { start: "18:00", end: "23:59" }
  categories:
    quick: 5
    standard: 10
  defaults:
    conversation: "standard"
    choice: "quick"
    movement: "quick"
    default: "standard"
    cap_per_visit: 60

movement:
  base_unit: "minutes"
  use_entry_exit: false
  methods:
    - name: "walk"
      category: "quick"
      active: true

meters:
  player:
    energy:
      min: 0
      max: 100
      default: 50
      visible: true

flags:
  low_enabled:
    type: "bool"
    default: false
  low_entered:
    type: "bool"
    default: false
  low_exited:
    type: "bool"
    default: false
  high_exited:
    type: "bool"
    default: false

characters:
  - id: "player"
    name: "Player"
    age: 21
    gender: "unspecified"
    pronouns: ["they"]

zones:
  - id: "zone_a"
    name: "Zone A"
    time_category: "standard"
    locations:
      - id: "lounge"
        name: "Lounge"
        access:
          discovered: true

modifiers:
  stacking:
    mood: "highest"
  library:
    - id: "low_mood"
      group: "mood"
      priority: 0
      duration: 30
      when: "flags.low_enabled == true"
      on_enter:
        - type: "flag_set"
          key: "low_entered"
          value: true
      on_exit:
        - type: "flag_set"
          key: "low_exited"
          value: true
    - id: "high_mood"
      group: "mood"
      priority: 2
      duration: 5
      on_enter:
        - type: "meter_change"
          target: "player"
          meter: "energy"
          op: "add"
          value: 5
      on_exit:
        - type: "flag_set"
          key: "high_exited"
          value: true

nodes:
  - id: "hub"
    type: "scene"
    title: "Stacking Hub"
    choices:
      - id: "apply_low"
        prompt: "Apply low mood"
        time_cost: 0
        on_select:
          - type: "flag_set"
            key: "low_enabled"
            value: true
          - type: "apply_modifier"
            target: "player"
            modifier_id: "low_mood"
      - id: "apply_high"
        prompt: "Apply high mood"
        time_cost: 0
        on_select:
          - type: "apply_modifier"
            target: "player"
            modifier_id: "high_mood"
      - id: "wait_out"
        prompt: "Wait and pass time"
        time_cost: 10
        on_select:
          - type: "meter_change"
            target: "player"
            meter: "energy"
            op: "add"
            value: 0
      - id: "ping"
        prompt: "Ping to trigger auto-activation"
        time_cost: 0
        on_select:
          - type: "meter_change"
            target: "player"
            meter: "energy"
            op: "add"
            value: 0
