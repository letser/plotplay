metadata:
  name: "Effects - Flag Set"
  description: "Test flag_set effect for setting boolean flags"
  game: "coffeeshop_date"
  author: "PlotPlay Team"
  tags: ["feature-effects", "phase-1", "flags"]

mocks:
  writer:
    intro: "You step onto the sunlit cafe patio. The aroma of fresh coffee fills the air. You spot Alex at one of the tables."
    greet: "Alex looks up from their phone and smiles warmly. 'Hey! Glad you could make it.'"
    order: "You suggest splitting the cost. Alex agrees with a warm smile."
    table: "Steam curls from your mugs as the afternoon crowd fades into soft chatter. Alex rests her chin on her hand, eyes bright with curiosity."
    funny_story: "You share the catastrophe of your first attempt at latte art. Alex bursts into genuine laughter, her eyes crinkling."

  checker:
    default:
      meters: {}
      flags: {}
      character_memories: {}
      safety:
        ok: true

steps:
  - name: "Start game with shared_laugh = false"
    action: start
    mock_writer_key: intro
    expect:
      node: "outside_cafe"
      flags:
        shared_laugh: false

  - name: "Proceed to order_drinks"
    action: choice
    choice_id: "greet_warmly"
    mock_writer_key: greet
    expect:
      node: "order_drinks"
      flags:
        shared_laugh: false

  - name: "Proceed to table_convo"
    action: choice
    choice_id: "split_the_bill"
    mock_writer_key: order
    expect:
      node: "table_convo"
      flags:
        shared_laugh: false

  - name: "Choose tell_funny_story (sets shared_laugh flag)"
    action: choice
    choice_id: "tell_funny_story"
    mock_writer_key: funny_story
    expect:
      flags:
        shared_laugh: true
