nodes:
  - id: "outside_cafe"
    type: "scene"
    title: "Outside Brewed Awakenings"
    characters_present: ["alex"]
    beats:
      - "You spot Alex waiting on the patio, sunlight catching the copper strands in her hair."
      - "She lifts a hand in a tentative wave, the mint jar between you glinting invitingly."
    on_entry:
      - type: "meter_change"
        target: "alex"
        meter: "comfort"
        op: "add"
        value: 5
    choices:
      - id: "greet_warmly"
        prompt: "Offer a warm compliment about her scarf."
        on_select:
          - type: "meter_change"
            target: "alex"
            meter: "comfort"
            op: "add"
            value: 10
          - type: "meter_change"
            target: "alex"
            meter: "interest"
            op: "add"
            value: 6
          - type: "meter_change"
            target: "player"
            meter: "confidence"
            op: "add"
            value: 4
          - type: "goto"
            node: "order_drinks"
      - id: "arrive_rushed"
        prompt: "Apologize for running a couple minutes late."
        on_select:
          - type: "meter_change"
            target: "alex"
            meter: "comfort"
            op: "add"
            value: 4
          - type: "meter_change"
            target: "player"
            meter: "confidence"
            op: "subtract"
            value: 6
          - type: "goto"
            node: "order_drinks"

  - id: "order_drinks"
    type: "scene"
    title: "Ordering Drinks"
    characters_present: ["alex"]
    beats:
      - "Inside, the scent of espresso wraps around you. Alex scan the chalkboard menu with a decisive nod."
      - "\"My treat?\" you offer, already fishing out your wallet."
    choices:
      - id: "matching_lattes"
        prompt: "Order matching vanilla lattes for the both of you."
        when: "meters.player.money >= 12"
        on_select:
          - type: "meter_change"
            target: "player"
            meter: "money"
            op: "subtract"
            value: 12
          - type: "meter_change"
            target: "alex"
            meter: "interest"
            op: "add"
            value: 8
          - type: "meter_change"
            target: "alex"
            meter: "comfort"
            op: "add"
            value: 6
          - type: "goto"
            node: "table_convo"
      - id: "let_her_choose"
        prompt: "Ask Alex to pick anything and insist on paying."
        when: "meters.player.money >= 10"
        on_select:
          - type: "meter_change"
            target: "player"
            meter: "money"
            op: "subtract"
            value: 10
          - type: "meter_change"
            target: "alex"
            meter: "interest"
            op: "add"
            value: 10
          - type: "goto"
            node: "table_convo"
      - id: "split_the_bill"
        prompt: "Suggest splitting the cost with a light joke."
        on_select:
          - type: "meter_change"
            target: "player"
            meter: "money"
            op: "subtract"
            value: 6
          - type: "meter_change"
            target: "alex"
            meter: "comfort"
            op: "add"
            value: 5
          - type: "goto"
            node: "table_convo"

  - id: "table_convo"
    type: "scene"
    title: "Corner Table Conversation"
    characters_present: ["alex"]
    beats:
      - "Steam curls from your mugs as the afternoon crowd fades into soft chatter."
      - "Alex rests her chin on her hand, eyes bright with curiosity."
    choices:
      - id: "ask_about_art"
        prompt: "Ask about the mural she mentioned in her messages."
        on_select:
          - type: "meter_change"
            target: "alex"
            meter: "comfort"
            op: "add"
            value: 12
          - type: "meter_change"
            target: "alex"
            meter: "interest"
            op: "add"
            value: 8
          - type: "goto"
            node: "share_story"
      - id: "tell_funny_story"
        prompt: "Share the catastrophe of your first attempt at latte art."
        on_select:
          - type: "meter_change"
            target: "alex"
            meter: "comfort"
            op: "add"
            value: 6
          - type: "meter_change"
            target: "alex"
            meter: "interest"
            op: "add"
            value: 12
          - type: "flag_set"
            key: "shared_laugh"
            value: true
          - type: "goto"
            node: "tell_joke"
      - id: "offer_compliment"
        prompt: "Compliment the way she pairs colors in her outfits."
        when: "gates.alex.accept_compliment"
        on_select:
          - type: "meter_change"
            target: "alex"
            meter: "comfort"
            op: "add"
            value: 9
          - type: "meter_change"
            target: "alex"
            meter: "interest"
            op: "add"
            value: 7
          - type: "goto"
            node: "share_story"

  - id: "share_story"
    type: "scene"
    title: "Finding Common Ground"
    characters_present: ["alex"]
    beats:
      - "\"I love that you notice the little things,\" she says. \"So what keeps you busy when you're not here?\""
      - You trade stories about weekend routines, the conversation loosening every minute.
    on_entry:
      - type: "meter_change"
        target: "alex"
        meter: "comfort"
        op: "add"
        value: 8
      - type: "meter_change"
        target: "alex"
        meter: "interest"
        op: "add"
        value: 6
    triggers:
      - when: "true"
        on_select:
          - type: "goto"
            node: "closing_moment"

  - id: "tell_joke"
    type: "scene"
    title: "Shared Laughter"
    characters_present: ["alex"]
    beats:
      - "Alex laughs so hard she has to dab foam from the corner of her mouth."
      - "\"Okay, you win,\" she grins. \"Next time I'm letting you handle the latte art.\""
    on_entry:
      - type: "meter_change"
        target: "alex"
        meter: "comfort"
        op: "add"
        value: 10
      - type: "meter_change"
        target: "alex"
        meter: "interest"
        op: "add"
        value: 10
    triggers:
      - when: "true"
        on_select:
          - type: "goto"
            node: "closing_moment"

  - id: "closing_moment"
    type: "scene"
    title: "Heading Out"
    characters_present: ["alex"]
    beats:
      - "Dusk edges in as you step back onto the patio, mugs empty but hands lingering close."
      - "Alex hesitates, weight shifting as though she's not quite ready to say goodbye."
    choices:
      - id: "propose_second_date"
        prompt: "Suggest meeting again for the night market this weekend."
        when_any:
          - "meters.alex.interest >= 60"
          - "flags.shared_laugh == true"
        on_select:
          - type: "meter_change"
            target: "alex"
            meter: "interest"
            op: "add"
            value: 8
          - type: "flag_set"
            key: "second_date_offer"
            value: true
          - type: "goto"
            node: "goodbye_success"
      - id: "graceful_farewell"
        prompt: "Offer a warm goodbye and promise to text later."
        on_select:
          - type: "goto"
            node: "goodbye_polite"

  - id: "goodbye_success"
    type: "ending"
    title: "Promising Second Date"
    characters_present: ["alex"]
    ending_id: "alex_second_date"
    beats:
      - "Alex's smile widens. \"I'd like that a lot,\" she says, tapping her number into your phone."
      - "\"Text me when you get home? I want to hear how the rest of your night goes.\""
    on_entry:
      - type: "meter_change"
        target: "player"
        meter: "confidence"
        op: "add"
        value: 6
      - type: "meter_change"
        target: "alex"
        meter: "comfort"
        op: "add"
        value: 6
    on_exit: []

  - id: "goodbye_polite"
    type: "ending"
    title: "Polite Parting"
    characters_present: ["alex"]
    ending_id: "coffee_date_polite"
    beats:
      - "\"This was really nice,\" Alex says, giving your arm a gentle squeeze."
      - "She heads down the sidewalk with a final wave, leaving the door open but uncertain."
    on_entry:
      - type: "meter_change"
        target: "player"
        meter: "confidence"
        op: "add"
        value: 2
