nodes:
  - id: "intro_dorm"
    type: "scene"
    title: "Morning Reset"
    characters_present: []
    beats:
      - "Sunlight slips past blackout curtains, splashing across textbooks, guitar cables, and the half-packed duffel on your bed."
      - "Two notifications blink on your phone: Emma asking about the stats assignment, Zoe hyping tonight's basement show."
    choices:
      - id: "head_to_quad"
        prompt: "Grab your backpack and cross the quad before class."
        on_select:
          - type: "move_to"
            location: "campus_quad"
          - type: "goto"
            node: "quad_catchup"
      - id: "swing_by_cafe"
        prompt: "Detour to the student cafe for caffeine and gossip."
        on_select:
          - type: "move_to"
            location: "campus_cafe"
          - type: "goto"
            node: "cafe_first_meet"
      - id: "stay_in_room"
        prompt: "Stay in and review your notes for a bit."
        on_select:
          - type: "meter_change"
            target: "player"
            meter: "mind"
            op: "add"
            value: 4
          - type: "goto"
            node: "afternoon_loop"

  - id: "quad_catchup"
    type: "scene"
    title: "Across the Quad"
    characters_present: ["emma"]
    beats:
      - "Emma sits under the sycamore, highlighters scattered, lips moving as she recites formulas."
      - "Her eyes brighten when she spots you, relief softening the stress lines in her forehead."
    on_entry:
      - type: "flag_set"
        key: "met_emma"
        value: true
      - type: "meter_change"
        target: "emma"
        meter: "trust"
        op: "add"
        value: 6
    choices:
      - id: "offer_study_help"
        prompt: "Offer to walk through the stats problem set together."
        on_select:
          - type: "flag_set"
            key: "emma_study_session"
            value: true
          - type: "meter_change"
            target: "emma"
            meter: "trust"
            op: "add"
            value: 6
          - type: "meter_change"
            target: "player"
            meter: "mind"
            op: "add"
            value: 3
          - type: "goto"
            node: "afternoon_loop"
      - id: "walk_with_emma"
        prompt: "Suggest grabbing lunch together after class."
        on_select:
          - type: "meter_change"
            target: "emma"
            meter: "attraction"
            op: "add"
            value: 6
          - type: "meter_change"
            target: "player"
            meter: "charm"
            op: "add"
            value: 3
          - type: "goto"
            node: "afternoon_loop"

  - id: "cafe_first_meet"
    type: "scene"
    title: "Bean There Banter"
    characters_present: ["zoe"]
    beats:
      - "Zoe balances three mismatched mugs in one hand, sliding a latte toward you with a smirk."
      - "\"You're the stats wizard, right? Come to rescue the caffeine-starved masses?\""
    on_entry:
      - type: "flag_set"
        key: "met_zoe"
        value: true
      - type: "meter_change"
        target: "zoe"
        meter: "trust"
        op: "add"
        value: 4
    choices:
      - id: "banter_back"
        prompt: "Introduce yourself with equally corny barista banter."
        on_select:
          - type: "meter_change"
            target: "zoe"
            meter: "attraction"
            op: "add"
            value: 7
          - type: "meter_change"
            target: "player"
            meter: "charm"
            op: "add"
            value: 4
          - type: "goto"
            node: "afternoon_loop"
      - id: "ask_about_band"
        prompt: "Ask how rehearsals are going for her band."
        on_select:
          - type: "meter_change"
            target: "zoe"
            meter: "trust"
            op: "add"
            value: 6
          - type: "goto"
            node: "afternoon_loop"

  - id: "afternoon_loop"
    type: "hub"
    title: "Afternoon Crossroads"
    characters_present: []
    beats:
      - "Classes blur past, leaving you with a stretch of afternoon to steer the day."
    dynamic_choices:
      - id: "study_with_emma"
        prompt: "Head to the library to follow up with Emma."
        when_any:
          - "flags.met_emma == true"
          - "flags.emma_study_session == true"
        on_select:
          - type: "goto"
            node: "library_session"
      - id: "drop_by_rehearsal"
        prompt: "Swing by the cafe during Zoe's rehearsal break."
        when: "flags.met_zoe == true"
        on_select:
          - type: "goto"
            node: "rehearsal_break"
    choices:
      - id: "prep_for_evening"
        prompt: "Call it here and figure out tonight."
        on_select:
          - type: "goto"
            node: "evening_choice"

  - id: "library_session"
    type: "scene"
    title: "Quiet Corners"
    characters_present: ["emma"]
    beats:
      - "Stacks of books create a fort around your table. Emma shares colored tabs, you trade mnemonics."
    on_entry:
      - type: "flag_set"
        key: "emma_study_session"
        value: true
      - type: "meter_change"
        target: "emma"
        meter: "trust"
        op: "add"
        value: 8
    choices:
      - id: "share_story"
        prompt: "Share a personal anecdote about bombing your first presentation."
        on_select:
          - type: "meter_change"
            target: "emma"
            meter: "trust"
            op: "add"
            value: 5
          - type: "meter_change"
            target: "emma"
            meter: "attraction"
            op: "add"
            value: 4
          - type: "goto"
            node: "afternoon_loop"
      - id: "walk_her_home"
        prompt: "Offer to walk Emma back to her dorm."
        on_select:
          - type: "meter_change"
            target: "emma"
            meter: "attraction"
            op: "add"
            value: 6
          - type: "goto"
            node: "evening_choice"

  - id: "rehearsal_break"
    type: "scene"
    title: "Backstage Banter"
    characters_present: ["zoe"]
    beats:
      - "Zoe drapes her guitar strap over your shoulders. \"Sing the chorus and I'll owe you forever.\""
    on_entry:
      - type: "meter_change"
        target: "zoe"
        meter: "attraction"
        op: "add"
        value: 6
    choices:
      - id: "offer_feedback"
        prompt: "Give thoughtful feedback on her new song."
        on_select:
          - type: "flag_set"
            key: "zoe_band_invite"
            value: true
          - type: "meter_change"
            target: "zoe"
            meter: "trust"
            op: "add"
            value: 7
          - type: "goto"
            node: "evening_choice"
      - id: "flirt_playfully"
        prompt: "Joke that you only attend shows for the backstage passes."
        on_select:
          - type: "meter_change"
            target: "zoe"
            meter: "attraction"
            op: "add"
            value: 8
          - type: "goto"
            node: "evening_choice"

  - id: "evening_choice"
    type: "scene"
    title: "Evening Plans"
    characters_present: []
    beats:
      - "The sun sets behind the dorms, texts buzzing in quick succession."
      - "Emma suggests a moonlit walk before curfew. Zoe sends the basement venue address."
    on_entry:
      - type: "flag_set"
        key: "evening_choice_made"
        value: false
    choices:
      - id: "choose_emma"
        prompt: "Text Emma and plan a quiet walk."
        when: "flags.met_emma == true"
        on_select:
          - type: "flag_set"
            key: "evening_choice_made"
            value: true
          - type: "goto"
            node: "emma_evening_walk"
      - id: "choose_zoe"
        prompt: "Head downtown to catch Zoe's set."
        when_any:
          - "flags.met_zoe == true"
          - "flags.zoe_band_invite == true"
        on_select:
          - type: "flag_set"
            key: "evening_choice_made"
            value: true
          - type: "goto"
            node: "zoe_basement_show"
      - id: "study_alone"
        prompt: "Stay in, brew tea, and get ahead on coursework."
        on_select:
          - type: "meter_change"
            target: "player"
            meter: "mind"
            op: "add"
            value: 6
          - type: "goto"
            node: "evening_study_alone"

  - id: "emma_evening_walk"
    type: "scene"
    title: "Moonlit Steps"
    characters_present: ["emma"]
    beats:
      - "The campus is hushed, fountain lights reflecting in Emma's glasses."
      - "She falls into stride beside you, breath fogging in the cool air."
    on_entry:
      - type: "meter_change"
        target: "emma"
        meter: "trust"
        op: "add"
        value: 8
    choices:
      - id: "share_feelings"
        prompt: "Tell Emma you're excited about where this is heading."
        on_select:
          - type: "flag_set"
            key: "emma_final_choice"
            value: true
          - type: "flag_set"
            key: "zoe_final_choice"
            value: false
          - type: "meter_change"
            target: "emma"
            meter: "attraction"
            op: "add"
            value: 10
          - type: "goto"
            node: "final_reflection"
      - id: "keep_it_easy"
        prompt: "Keep the night light with campus gossip."
        on_select:
          - type: "meter_change"
            target: "emma"
            meter: "trust"
            op: "add"
            value: 4
          - type: "goto"
            node: "final_reflection"

  - id: "zoe_basement_show"
    type: "scene"
    title: "Basement Show"
    characters_present: ["zoe"]
    beats:
      - "The basement thrums with bass. Zoe's grin is all mischief when she spots you in the crowd."
      - "Sweat-slick walls vibrate as she pulls you toward the backstage staircase."
    on_entry:
      - type: "meter_change"
        target: "zoe"
        meter: "attraction"
        op: "add"
        value: 9
    choices:
      - id: "stay_late"
        prompt: "Stay after the set to help pack gear."
        on_select:
          - type: "flag_set"
            key: "zoe_final_choice"
            value: true
          - type: "flag_set"
            key: "emma_final_choice"
            value: false
          - type: "meter_change"
            target: "zoe"
            meter: "trust"
            op: "add"
            value: 8
          - type: "goto"
            node: "final_reflection"
      - id: "call_it_night"
        prompt: "Congratulate her and head home early."
        on_select:
          - type: "goto"
            node: "final_reflection"

  - id: "evening_study_alone"
    type: "scene"
    title: "Quiet Victory"
    characters_present: []
    beats:
      - "The dorm is quiet save for the hum of your desk lamp."
      - "Notes align, plans crystallize, and both messages sit unanswered for now."
    triggers:
      - when: "true"
        on_select:
          - type: "goto"
            node: "ending_solo"

  - id: "final_reflection"
    type: "scene"
    title: "Late-Night Reflections"
    characters_present: []
    beats:
      - "Back in your dorm, the night settles into a comfortable hush."
      - "Two different futures glow on your phone screen."
    triggers:
      - when: "flags.emma_final_choice == true"
        on_select:
          - type: "goto"
            node: "ending_emma"
      - when: "flags.zoe_final_choice == true"
        on_select:
          - type: "goto"
            node: "ending_zoe"
      - when: "true"
        on_select:
          - type: "goto"
            node: "ending_solo"

  - id: "ending_emma"
    type: "ending"
    title: "Shared Notes"
    characters_present: ["emma"]
    ending_id: "ending_emma"
    beats:
      - "Emma passes you a neatly folded note: \"Next coffee is on me.\""
      - "The campus feels smaller, the future a little more certain."

  - id: "ending_zoe"
    type: "ending"
    title: "Second Encore"
    characters_present: ["zoe"]
    ending_id: "ending_zoe"
    beats:
      - "Zoe tugs you onstage during soundcheck, hands warm around yours."
      - "\"Ready to make this our duet?\" she asks above the cheering."

  - id: "ending_solo"
    type: "ending"
    title: "Still Figuring It Out"
    characters_present: []
    ending_id: "ending_solo"
    beats:
      - "You file flashcards back into their case and silence your phone."
      - "Some nights are for choosing yourself—and tomorrow is wide open."
